_target_: uni2ts.model.llm_moirai.LlmMoiraiFinetune
_args_:
  module_kwargs:
    _target_: builtins.dict
    distr_output:
      _target_: uni2ts.distribution.MixtureOutput
      components:
        - _target_: uni2ts.distribution.StudentTOutput
        - _target_: uni2ts.distribution.NormalFixedScaleOutput
        - _target_: uni2ts.distribution.NegativeBinomialOutput
        - _target_: uni2ts.distribution.LogNormalOutput
    d_model: 384
    num_layers: 6
    patch_sizes: ${as_tuple:[8, 16, 32, 64, 128]}
    max_seq_len: 512
    attn_dropout_p: 0.0
    dropout_p: 0.0
    scaling: true

  llm_kwargs:
    _target_: builtins.dict
    llm_model: LLAMA
    d_llm: 4096
    llm_layers: 6

#  task_kwargs:
#    _target_: builtins.dict
#    prediction_length: 96
#    context_length: 5000
#    patch_size: 64  # auto

#  task_kwargs:
#    _target_: builtins.dict
#    prediction_length: 96
#    context_length: 4000
#    patch_size: 128  # auto

  moirai_opt_mode: freeze # freeze/full/ Norm+InProject+OutProject
  min_patches: 2
  min_mask_ratio: 0.15
  max_mask_ratio: 0.5
  max_dim: 128
  loss_func:
    _target_: uni2ts.loss.packed.PackedNLLLoss
  lr: 1e-3
  weight_decay: 1e-1
  beta1: 0.9
  beta2: 0.98
  num_training_steps: ${mul:${trainer.max_epochs},${train_dataloader.num_batches_per_epoch}}
  num_warmup_steps: 0
  checkpoint_path:
    _target_: huggingface_hub.hf_hub_download
    repo_id: Salesforce/moirai-1.0-R-small
    filename: model.ckpt